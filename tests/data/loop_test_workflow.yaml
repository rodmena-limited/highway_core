description: ''
name: tier_3_loop_test
start_task: initialize_counter
tasks:
  fetch_user:
    args:
    - https://jsonplaceholder.typicode.com/users/{{item}}
    dependencies:
    - process_users_foreach
    function: tools.fetch.get
    kwargs: {}
    metadata: {}
    operator_type: task
    result_key: user_data
    task_id: fetch_user
  increment_counter:
    args:
    - loop_counter
    dependencies:
    - main_while_loop
    function: tools.memory.increment
    kwargs: {}
    metadata: {}
    operator_type: task
    result_key: counter_result
    task_id: increment_counter
  initialize_counter:
    args:
    - loop_counter
    - 0
    dependencies: []
    function: tools.memory.set
    kwargs: {}
    metadata: {}
    operator_type: task
    result_key: init_counter
    task_id: initialize_counter
  log_end:
    args:
    - Tier 3 Test Finished.
    dependencies:
    - process_users_foreach
    function: tools.log.info
    kwargs: {}
    metadata: {}
    operator_type: task
    task_id: log_end
  log_user:
    args:
    - 'Fetched user: {{results.user_data.data.name}} (ID: {{item}})'
    dependencies:
    - fetch_user
    function: tools.log.info
    kwargs: {}
    metadata: {}
    operator_type: task
    task_id: log_user
  log_while_complete:
    args:
    - 'While loop complete. Final counter: {{memory.loop_counter}}'
    dependencies:
    - main_while_loop
    function: tools.log.info
    kwargs: {}
    metadata: {}
    operator_type: task
    task_id: log_while_complete
  main_while_loop:
    condition: '{{memory.loop_counter}} < 3'
    dependencies:
    - initialize_counter
    loop_body:
    - args:
      - loop_counter
      dependencies:
      - main_while_loop
      function: tools.memory.increment
      kwargs: {}
      metadata: {}
      operator_type: task
      result_key: counter_result
      task_id: increment_counter
    metadata: {}
    operator_type: while
    task_id: main_while_loop
  process_users_foreach:
    dependencies:
    - log_while_complete
    items: '{{variables.user_ids}}'
    loop_body:
    - args:
      - https://jsonplaceholder.typicode.com/users/{{item}}
      dependencies:
      - process_users_foreach
      function: tools.fetch.get
      kwargs: {}
      metadata: {}
      operator_type: task
      result_key: user_data
      task_id: fetch_user
    - args:
      - 'Fetched user: {{results.user_data.data.name}} (ID: {{item}})'
      dependencies:
      - fetch_user
      function: tools.log.info
      kwargs: {}
      metadata: {}
      operator_type: task
      task_id: log_user
    metadata: {}
    operator_type: foreach
    task_id: process_users_foreach
variables:
  user_ids:
  - 1
  - 2
  - 3
version: 1.0.0

